<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’– Siempre a Tiempo</title>
    <meta name="theme-color" content="#ec4899">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="manifest" href="/manifest.json">
    <style>
        /* (CSS idÃ©ntico al proporcionado por el usuario) */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --primary: #ec4899; --secondary: #be185d; --accent: #f9a8d4; --light: #fce7f3; --white: rgba(255, 255, 255, 0.95); --shadow: rgba(236, 72, 153, 0.3); --gradient: linear-gradient(135deg, #f9a8d4 0%, #ec4899 50%, #be185d 100%); --glass: rgba(255, 255, 255, 0.1); }
        body { font-family: 'Arial', sans-serif; background: var(--gradient); min-height: 100vh; overflow-x: hidden; position: relative; }
        .floating-particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
        .particle { position: absolute; font-size: 20px; animation: float 6s ease-in-out infinite; opacity: 0.7; }
        @keyframes float { 0%, 100% { transform: translateY(100vh) rotate(0deg); opacity: 0; } 10%, 90% { opacity: 0.7; } 50% { transform: translateY(-20px) rotate(180deg); opacity: 1; } }
        .app-container { position: relative; z-index: 2; min-height: 100vh; display: flex; flex-direction: column; }
        .gradient-header { background: var(--white); backdrop-filter: blur(20px); padding: 1.5rem; box-shadow: 0 8px 32px var(--shadow); border-bottom: 1px solid rgba(255, 255, 255, 0.2); }
        .logo-text { text-align: center; font-size: 2.5rem; font-weight: bold; background: var(--gradient); -webkit-background-clip: text; background-clip: text; color: transparent; margin-bottom: 1rem; animation: breathe 3s ease-in-out infinite; }
        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .tab-navigation { display: flex; justify-content: space-around; gap: 0.5rem; }
        .nav-tab { flex: 1; padding: 0.8rem 0.5rem; background: var(--glass); border: 1px solid rgba(236, 72, 153, 0.3); border-radius: 15px; text-align: center; cursor: pointer; transition: all 0.3s ease; font-size: 0.9rem; color: var(--secondary); font-weight: 600; position: relative; overflow: hidden; }
        .nav-tab:hover { transform: translateY(-2px); box-shadow: 0 8px 25px var(--shadow); background: var(--white); }
        .nav-tab.active { background: var(--gradient); color: white; box-shadow: 0 8px 25px var(--shadow); }
        .nav-tab.active::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); animation: shine 2s infinite; }
        @keyframes shine { 0% { left: -100%; } 100% { left: 100%; } }
        .content-area { flex: 1; padding: 2rem 1rem; position: relative; }
        .section { display: none; animation: fadeInUp 0.5s ease-out; }
        .section.active { display: block; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .card { background: var(--white); border-radius: 20px; padding: 2rem; margin-bottom: 1.5rem; box-shadow: 0 8px 32px var(--shadow); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.3); transition: all 0.3s ease; }
        .card:hover { transform: translateY(-5px) scale(1.02); box-shadow: 0 15px 40px var(--shadow); }
        .card-title { font-size: 1.5rem; font-weight: bold; color: var(--secondary); margin-bottom: 1rem; text-align: center; }
        .input-group { margin-bottom: 1.5rem; }
        .input-label { display: block; color: var(--secondary); font-weight: 600; margin-bottom: 0.5rem; font-size: 1rem; }
        .form-input { width: 100%; padding: 1rem 1.5rem; border: 2px solid var(--accent); border-radius: 15px; background: rgba(255, 255, 255, 0.9); color: var(--secondary); font-size: 1rem; transition: all 0.3s ease; }
        .form-input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 20px rgba(236, 72, 153, 0.3); transform: translateY(-2px); }
        .btn-primary { background: var(--gradient); color: white; border: none; padding: 1rem 2rem; border-radius: 15px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden; width: 100%; margin-top: 1rem; }
        .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 10px 30px var(--shadow); }
        .btn-primary:active { animation: pulse 0.3s ease; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(0.95); } 100% { transform: scale(1); } }
        .task-item { background: rgba(255, 255, 255, 0.8); padding: 1.5rem; border-radius: 15px; margin-bottom: 1rem; border-left: 5px solid var(--primary); transition: all 0.3s ease; position: relative; overflow: hidden; }
        .task-item:hover { transform: translateX(10px); box-shadow: 0 5px 20px var(--shadow); }
        .task-item.completed { opacity: 0.7; background: var(--light); border-left-color: var(--accent); }
        .task-item.completed::after { content: 'âœ¨'; position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); font-size: 1.5rem; animation: sparkle 1s ease-in-out infinite; }
        @keyframes sparkle { 0%, 100% { transform: translateY(-50%) scale(1); } 50% { transform: translateY(-50%) scale(1.2); } }
        .task-title { font-weight: bold; color: var(--secondary); margin-bottom: 0.5rem; font-size: 1.1rem; }
        .task-time { color: var(--primary); font-size: 0.9rem; font-weight: 600; }
        .progress-container { background: rgba(255, 255, 255, 0.3); height: 10px; border-radius: 10px; margin: 1rem 0; overflow: hidden; }
        .progress-bar { height: 100%; background: var(--gradient); border-radius: 10px; transition: width 0.5s ease; position: relative; }
        .progress-bar::after { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent); animation: progressShine 2s infinite; }
        @keyframes progressShine { 0% { left: -100%; } 100% { left: 100%; } }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin: 1rem 0; }
        .stat-item { background: var(--white); padding: 1.5rem 1rem; border-radius: 15px; text-align: center; box-shadow: 0 5px 20px var(--shadow); transition: transform 0.3s ease; }
        .stat-item:hover { transform: translateY(-5px); }
        .stat-number { font-size: 2rem; font-weight: bold; color: var(--primary); margin-bottom: 0.5rem; }
        .stat-label { color: var(--secondary); font-size: 0.9rem; font-weight: 600; }
        .floating-btn { position: fixed; bottom: 2rem; right: 2rem; width: 60px; height: 60px; background: var(--gradient); border-radius: 50%; border: none; color: white; font-size: 1.5rem; cursor: pointer; box-shadow: 0 8px 30px var(--shadow); transition: all 0.3s ease; z-index: 1000; }
        .floating-btn:hover { transform: scale(1.1) translateY(-3px); box-shadow: 0 12px 40px var(--shadow); }
        .survey-question { margin-bottom: 2rem; }
        .survey-options { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .survey-option { background: var(--white); padding: 1.5rem; border-radius: 15px; text-align: center; cursor: pointer; transition: all 0.3s ease; border: 2px solid transparent; }
        .survey-option:hover { transform: translateY(-3px); box-shadow: 0 8px 25px var(--shadow); }
        .survey-option.selected { border-color: var(--primary); background: var(--light); transform: scale(1.05); }
        .survey-option-emoji { font-size: 2rem; margin-bottom: 0.5rem; display: block; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: var(--accent); border-radius: 15px; overflow: hidden; margin-top: 1rem; }
        .calendar-day { background: white; padding: 1rem 0.5rem; text-align: center; min-height: 80px; position: relative; transition: all 0.3s ease; }
        .calendar-day:hover { background: var(--light); transform: scale(1.05); }
        .calendar-day.today { background: var(--gradient); color: white; }
        .calendar-day.has-tasks::after { content: 'â€¢'; position: absolute; bottom: 5px; left: 50%; transform: translateX(-50%); color: var(--primary); font-size: 1.5rem; }
        .notification-toast { position: fixed; top: 2rem; right: 2rem; background: var(--white); padding: 1rem 1.5rem; border-radius: 15px; box-shadow: 0 8px 32px var(--shadow); border-left: 5px solid var(--primary); transform: translateX(400px); transition: all 0.5s ease; z-index: 1001; max-width: 300px; }
        .notification-toast.show { transform: translateX(0); }
        .confetti { position: fixed; width: 10px; height: 10px; background: var(--primary); animation: confetti-fall 3s linear forwards; z-index: 1000; }
        @keyframes confetti-fall { 0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        .empty-state { text-align: center; padding: 3rem 1rem; color: var(--secondary); opacity: 0.7; }
        .empty-state-emoji { font-size: 4rem; margin-bottom: 1rem; }
        @media (max-width: 768px) { .logo-text { font-size: 2rem; } .nav-tab { font-size: 0.8rem; padding: 0.6rem 0.3rem; } .card { padding: 1.5rem; } .content-area { padding: 1rem; } .survey-options { grid-template-columns: 1fr; } .stats-grid { grid-template-columns: repeat(2, 1fr); } }
    </style>
</head>
<body>
    <div class="floating-particles" id="particles"></div>
    <main class="app-container">
        <header class="gradient-header">
            <h1 class="logo-text">ğŸ’– Siempre a Tiempo</h1>
            <nav class="tab-navigation">
                <div class="nav-tab active" data-section="configure"><span>âœ¨ Configurar</span></div>
                <div class="nav-tab" data-section="ai-schedule"><span>ğŸ§  Horario IA</span></div>
                <div class="nav-tab" data-section="tasks"><span>ğŸ“‹ Mis Tareas</span></div>
                <div class="nav-tab" data-section="calendar"><span>ğŸ“… Calendario</span></div>
            </nav>
        </header>
        <section class="content-area">
            <div class="section active" id="configure">
                <div class="card">
                    <div class="card-title">âœ¨ Agregar Nueva Tarea</div>
                    <form id="task-form">
                        <div class="input-group">
                            <label class="input-label">ğŸ¯ TÃ­tulo de la Tarea</label>
                            <input type="text" class="form-input" id="task-title" placeholder="Â¿QuÃ© necesitas hacer hoy?" required>
                        </div>
                        <div class="input-group">
                            <label class="input-label">ğŸ“ DescripciÃ³n (Opcional)</label>
                            <input type="text" class="form-input" id="task-description" placeholder="Detalles adicionales...">
                        </div>
                        <div class="input-group">
                            <label class="input-label">â° Hora</label>
                            <input type="time" class="form-input" id="task-time" required>
                        </div>
                        <div class="input-group">
                            <label class="input-label">ğŸ“… Fecha</label>
                            <input type="date" class="form-input" id="task-date" required>
                        </div>
                        <div class="input-group">
                            <label class="input-label">ğŸ”¥ Prioridad</label>
                            <select class="form-input" id="task-priority">
                                <option value="low">ğŸŒ¸ Baja - Cuando puedas</option>
                                <option value="normal" selected>ğŸ’– Normal - Importante</option>
                                <option value="high">ğŸ”¥ Alta - Â¡Es momento de brillar!</option>
                                <option value="critical">ğŸš¨ CrÃ­tica - Â¡SÃšPER URGENTE!</option>
                            </select>
                        </div>
                        <button type="submit" class="btn-primary">âœ¨ Crear Tarea MÃ¡gica</button>
                    </form>
                </div>
            </div>
            <div class="section" id="ai-schedule">
                <div class="card">
                    <div class="card-title">ğŸ§  Encuesta Inteligente</div>
                    <div id="survey-container">
                        <div class="survey-question">
                            <h3>ğŸŒ… Â¿CuÃ¡l es tu horario ideal?</h3>
                            <div class="survey-options">
                                <div class="survey-option" data-value="early"><span class="survey-option-emoji">ğŸŒ…</span><div>Madrugador</div><small>5:00 - 8:00 AM</small></div>
                                <div class="survey-option" data-value="morning"><span class="survey-option-emoji">â˜€ï¸</span><div>MaÃ±anero</div><small>8:00 - 11:00 AM</small></div>
                                <div class="survey-option" data-value="afternoon"><span class="survey-option-emoji">ğŸŒ¤ï¸</span><div>Tarde</div><small>2:00 - 6:00 PM</small></div>
                                <div class="survey-option" data-value="night"><span class="survey-option-emoji">ğŸŒ™</span><div>Nocturno</div><small>8:00 PM - 12:00 AM</small></div>
                            </div>
                        </div>
                        <div class="survey-question">
                            <h3>ğŸ’ª Â¿QuÃ© actividades realizas habitualmente?</h3>
                            <div class="survey-options" id="activity-options">
                                <div class="survey-option" data-value="study"><span class="survey-option-emoji">ğŸ“š</span><div>Estudiar</div></div>
                                <div class="survey-option" data-value="work"><span class="survey-option-emoji">ğŸ’¼</span><div>Trabajar</div></div>
                                <div class="survey-option" data-value="exercise"><span class="survey-option-emoji">ğŸƒâ€â™€ï¸</span><div>Ejercicio</div></div>
                                <div class="survey-option" data-value="creative"><span class="survey-option-emoji">ğŸ¨</span><div>Creatividad</div></div>
                                <div class="survey-option" data-value="social"><span class="survey-option-emoji">ğŸ‘¥</span><div>Socializar</div></div>
                                <div class="survey-option" data-value="rest"><span class="survey-option-emoji">ğŸ˜Œ</span><div>Descansar</div></div>
                            </div>
                        </div>
                        <button class="btn-primary" id="generate-schedule-btn">ğŸš€ Generar Mi Horario Perfecto</button>
                        <div id="ai-result" style="margin-top:1rem; display:none;"></div>
                    </div>
                </div>
            </div>
            <div class="section" id="tasks">
                <div class="card">
                    <div class="card-title">ğŸ“‹ Dashboard de Productividad</div>
                    <div class="stats-grid">
                        <div class="stat-item"><div class="stat-number" id="total-tasks">0</div><div class="stat-label">Tareas Total</div></div>
                        <div class="stat-item"><div class="stat-number" id="completed-tasks">0</div><div class="stat-label">Completadas</div></div>
                        <div class="stat-item"><div class="stat-number" id="productivity-score">0%</div><div class="stat-label">Productividad</div></div>
                        <div class="stat-item"><div class="stat-number" id="streak-days">ğŸ”¥0</div><div class="stat-label">Racha Diaria</div></div>
                    </div>
                    <div class="progress-container"><div class="progress-bar" id="daily-progress" style="width: 0%"></div></div>
                    <div id="task-list"><div class="empty-state"><div class="empty-state-emoji">ğŸŒ¸</div><p>Â¡Agrega tu primera tarea mÃ¡gica!</p></div></div>
                </div>
            </div>
            <div class="section" id="calendar">
                <div class="card">
                    <div class="card-title">ğŸ“… Calendario MÃ¡gico</div>
                    <div class="calendar-grid" id="calendar-container"></div>
                </div>
            </div>
        </section>
        <button class="floating-btn" onclick="showQuickAdd()">+</button>
    </main>
    <div class="notification-toast" id="notification"><div id="notification-content"></div></div>

    <script>
        // -------------------- Estado de la app --------------------
        let appState = { tasks: [], currentSection: 'configure', surveyData: {}, streak: 0, level: 1 };

        const notificationStyles = {
            critical: "ğŸš¨ Â¡SÃšPER URGENTE! {task} - Â¡No puede esperar mÃ¡s!",
            high: "ğŸ”¥ Â¡Es momento de brillar! Tu actividad '{task}' te espera",
            normal: "ğŸ’– Recordatorio cariÃ±oso: {task} en 15 minutos",
            low: "ğŸŒ¸ Cuando puedas: {task}",
            motivational: ["Â¡TÃº puedes! ğŸ’ª", "Â¡Eres increÃ­ble! â­", "Â¡A darle! ğŸš€"]
        };

        document.addEventListener('DOMContentLoaded', function() {
            loadData(); createParticles(); generateCalendar(); updateStats(); initNavigation(); initTaskForm(); requestNotificationPermission(); initSurvey(); registerServiceWorker();
        });

        // -------------------- NavegaciÃ³n --------------------
        function initNavigation(){
            const tabs = document.querySelectorAll('.nav-tab');
            const sections = document.querySelectorAll('.section');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetSection = tab.dataset.section;
                    tabs.forEach(t=>t.classList.remove('active'));
                    tab.classList.add('active');
                    sections.forEach(s=>s.classList.remove('active'));
                    document.getElementById(targetSection).classList.add('active');
                    appState.currentSection = targetSection;
                });
            });
        }

        // -------------------- PartÃ­culas --------------------
        function createParticles(){
            const particleContainer = document.getElementById('particles');
            const particles = ['ğŸ’–','âœ¨','ğŸŒ¸','ğŸ’«','ğŸŒŸ','ğŸ’•'];
            setInterval(()=>{
                if(Math.random()<0.6){
                    const particle = document.createElement('div');
                    particle.className='particle';
                    particle.textContent = particles[Math.floor(Math.random()*particles.length)];
                    particle.style.left = Math.random()*100 + '%';
                    particle.style.top = Math.random()*100 + '%';
                    particle.style.fontSize = (10 + Math.random()*30) + 'px';
                    particle.style.animationDuration = (4 + Math.random()*5) + 's';
                    particleContainer.appendChild(particle);
                    setTimeout(()=>particle.remove(), 9000);
                }
            }, 700);
        }

        // -------------------- Formulario de tareas --------------------
        function initTaskForm(){
            const form = document.getElementById('task-form');
            const now = new Date();
            document.getElementById('task-date').value = now.toISOString().split('T')[0];
            document.getElementById('task-time').value = now.toTimeString().slice(0,5);
            form.addEventListener('submit', function(e){ e.preventDefault(); addTask(); });
        }

        function addTask(){
            const title = document.getElementById('task-title').value.trim();
            if(!title) return showNotification('Escribe un tÃ­tulo para la tarea','error');
            const description = document.getElementById('task-description').value.trim();
            const time = document.getElementById('task-time').value;
            const date = document.getElementById('task-date').value;
            const priority = document.getElementById('task-priority').value;
            const task = { id: Date.now(), title, description, time, date, priority, completed:false, createdAt: new Date().toISOString() };
            appState.tasks.push(task); saveData(); renderTasks(); updateStats();
            document.getElementById('task-form').reset(); const now = new Date(); document.getElementById('task-date').value = now.toISOString().split('T')[0];
            showNotification('âœ¨ Â¡Tarea creada con Ã©xito!', 'success'); createConfetti(); generateCalendar();
        }

        function getPriorityEmoji(priority){
            const emojis = { low: 'ğŸŒ¸', normal: 'ğŸ’–', high: 'ğŸ”¥', critical: 'ğŸš¨' };
            return emojis[priority] || 'ğŸŒ¸';
        }

        function toggleTask(id){
            const task = appState.tasks.find(t=>t.id===id);
            if(!task) return;
            task.completed = !task.completed; saveData(); renderTasks(); updateStats();
            if(task.completed) { createConfetti(); showNotification(`ğŸ‰ Â¡Tarea completada! ${task.title}`, 'success'); }
        }

        function deleteTask(id){
            appState.tasks = appState.tasks.filter(t=>t.id!==id); saveData(); renderTasks(); updateStats(); generateCalendar();
            showNotification('ğŸ—‘ï¸ Tarea eliminada', 'info');
        }

        function renderTasks(){
            const taskList = document.getElementById('task-list');
            if(appState.tasks.length===0){ taskList.innerHTML = `<div class="empty-state"><div class="empty-state-emoji">ğŸŒ¸</div><p>Â¡Agrega tu primera tarea mÃ¡gica!</p></div>`; return; }
            const today = new Date().toISOString().split('T')[0];
            const todayTasks = appState.tasks.filter(task => task.date === today).sort((a,b)=>a.time.localeCompare(b.time));
            if(todayTasks.length===0){ taskList.innerHTML = `<div class="empty-state"><div class="empty-state-emoji">ğŸŒ™</div><p>No hay tareas para hoy</p></div>`; return; }
            taskList.innerHTML = todayTasks.map(task=>`
                <div class="task-item ${task.completed? 'completed':''}" data-id="${task.id}">
                    <div class="task-title">${getPriorityEmoji(task.priority)} ${escapeHtml(task.title)}</div>
                    <div class="task-time">â° ${task.time}</div>
                    ${task.description? `<div class="task-description">${escapeHtml(task.description)}</div>`: ''}
                    <div style="margin-top:1rem;">
                        <button onclick="toggleTask(${task.id})" style="background: var(--gradient); color: white; border: none; padding: 0.5rem 1rem; border-radius: 10px; cursor: pointer; margin-right: 0.5rem;">${task.completed ? 'â†©ï¸ Deshacer' : 'âœ… Completar'}</button>
                        <button onclick="deleteTask(${task.id})" style="background: #ef4444; color: white; border: none; padding: 0.5rem 1rem; border-radius: 10px; cursor: pointer;">ğŸ—‘ï¸ Eliminar</button>
                    </div>
                </div>
            `).join('');
        }

        // -------------------- Storage --------------------
        function saveData(){
            localStorage.setItem('timeorganizer_v1', JSON.stringify(appState));
        }
        function loadData(){
            const raw = localStorage.getItem('timeorganizer_v1');
            if(raw){ try{ const parsed = JSON.parse(raw); appState = Object.assign(appState, parsed); }catch(e){ console.warn('No se pudo leer storage'); } }
            renderTasks(); updateStats();
        }

        // -------------------- EstadÃ­sticas --------------------
        function updateStats(){
            const total = appState.tasks.length;
            const completed = appState.tasks.filter(t=>t.completed).length;
            const productivity = total === 0 ? 0 : Math.round((completed/total)*100);
            document.getElementById('total-tasks').textContent = total;
            document.getElementById('completed-tasks').textContent = completed;
            document.getElementById('productivity-score').textContent = `${productivity}%`;
            document.getElementById('streak-days').textContent = `ğŸ”¥${appState.streak || 0}`;
            document.getElementById('daily-progress').style.width = `${productivity}%`;
        }

        // -------------------- Notificaciones y Toasts --------------------
        function showNotification(message, type='info'){
            const toast = document.getElementById('notification');
            const content = document.getElementById('notification-content');
            content.textContent = message;
            toast.classList.add('show');
            setTimeout(()=> toast.classList.remove('show'), 3500);
            // Try native notification
            if(type !== 'error' && Notification && Notification.permission === 'granted'){
                new Notification('TimeOrganizer', { body: message, icon: '' });
            }
        }

        function requestNotificationPermission(){
            if('Notification' in window && Notification.permission !== 'granted'){
                Notification.requestPermission().then(permission=>{ if(permission==='granted') showNotification('ğŸ”” Notificaciones activadas', 'info'); });
            }
        }

        // -------------------- Confetti simple --------------------
        function createConfetti(count=18){
            for(let i=0;i<count;i++){
                const c = document.createElement('div'); c.className='confetti';
                c.style.left = Math.random()*100 + '%'; c.style.background = randomColor(); c.style.width = (6+Math.random()*10)+'px'; c.style.height = (6+Math.random()*14)+'px'; c.style.top = '-10vh'; c.style.opacity = Math.random(); c.style.transform = `rotate(${Math.random()*360}deg)`;
                document.body.appendChild(c);
                setTimeout(()=> c.remove(), 3200 + Math.random()*1000);
            }
        }
        function randomColor(){ const cols = ['#f472b6','#fb7185','#f9a8d4','#f43f5e','#ec4899','#be185d']; return cols[Math.floor(Math.random()*cols.length)]; }

        // -------------------- Calendario --------------------
        function generateCalendar(){
            const container = document.getElementById('calendar-container'); container.innerHTML = '';
            const now = new Date(); const year = now.getFullYear(); const month = now.getMonth();
            const firstDay = new Date(year, month, 1); const startDay = firstDay.getDay();
            const daysInMonth = new Date(year, month+1, 0).getDate();
            // Fill blanks before start
            for(let i=0;i<startDay;i++){ const cell = document.createElement('div'); cell.className='calendar-day'; container.appendChild(cell); }
            for(let d=1; d<=daysInMonth; d++){
                const dateStr = new Date(year, month, d).toISOString().split('T')[0];
                const cell = document.createElement('div'); cell.className='calendar-day';
                if(dateStr === new Date().toISOString().split('T')[0]) cell.classList.add('today');
                const tasksCount = appState.tasks.filter(t=>t.date===dateStr).length;
                if(tasksCount>0) cell.classList.add('has-tasks');
                cell.innerHTML = `<div style="font-weight:600">${d}</div>` + (tasksCount? `<div style="font-size:0.8rem; margin-top:6px;">${tasksCount} tareas</div>`:'');
                cell.addEventListener('click', ()=>{ document.getElementById('task-date').value = dateStr; document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active')); document.querySelector('.nav-tab[data-section="configure"]').classList.add('active'); document.querySelectorAll('.section').forEach(s=>s.classList.remove('active')); document.getElementById('configure').classList.add('active'); window.scrollTo({ top:0, behavior:'smooth' }); });
                container.appendChild(cell);
            }
        }

        // -------------------- IA (simulada) --------------------
        function initSurvey(){
            document.querySelectorAll('#survey-container .survey-option').forEach(opt=>{
                opt.addEventListener('click', ()=>{
                    const val = opt.dataset.value;
                    if(opt.parentElement.id === 'activity-options'){
                        opt.classList.toggle('selected');
                    } else {
                        document.querySelectorAll('.survey-option[data-value]').forEach(o=>o.classList.remove('selected'));
                        opt.classList.add('selected');
                    }
                });
            });

            document.getElementById('generate-schedule-btn').addEventListener('click', (e)=>{ e.preventDefault(); generateAISchedule(); });
        }

        function generateAISchedule(){
            // Recolectar datos de encuesta
            const chrono = document.querySelector('.survey-option.selected')?.dataset.value || 'morning';
            const activities = Array.from(document.querySelectorAll('#activity-options .survey-option.selected')).map(n=>n.dataset.value);
            // Guardar
            appState.surveyData = { chrono, activities };
            // Algoritmo simple de ejemplo: asigna slots segÃºn prioridad y energÃ­a
            const baseHour = { early:6, morning:9, afternoon:15, night:20 }[chrono] || 9;
            const slots = [];
            const chosen = activities.length? activities : ['study','work','rest'];
            chosen.forEach((act, idx)=>{
                const hour = (baseHour + idx*2) % 24;
                const hStr = String(hour).padStart(2,'0') + ':00';
                slots.push({ activity: act, time: hStr });
            });
            // Mostrar resultado
            const result = document.getElementById('ai-result'); result.style.display='block';
            result.innerHTML = `<div style="padding:1rem; border-radius:12px; background:rgba(255,255,255,0.9)">` +
                `<strong>Horario sugerido</strong><div style="margin-top:8px">${slots.map(s=>`<div>â€¢ ${emojiForActivity(s.activity)} ${capitalize(s.activity)} â€” ${s.time}</div>`).join('')}</div></div>`;
            showNotification('ğŸ§  Horario IA generado', 'info');
        }

        function emojiForActivity(key){ const map = { study:'ğŸ“š', work:'ğŸ’¼', exercise:'ğŸƒâ€â™€ï¸', creative:'ğŸ¨', social:'ğŸ‘¥', rest:'ğŸ˜Œ' }; return map[key]||'âœ¨'; }
        function capitalize(s){ return s.charAt(0).toUpperCase()+s.slice(1); }

        // -------------------- Quick Add --------------------
        function showQuickAdd(){
            // Simple prompt quick add for mobile
            const title = prompt('TÃ­tulo de la tarea'); if(!title) return;
            const date = new Date().toISOString().split('T')[0];
            const time = new Date().toTimeString().slice(0,5);
            const task = { id: Date.now(), title, description:'', time, date, priority:'normal', completed:false, createdAt:new Date().toISOString() };
            appState.tasks.push(task); saveData(); renderTasks(); updateStats(); generateCalendar(); showNotification('âœ¨ Tarea rÃ¡pida aÃ±adida', 'success');
        }

        // -------------------- Service Worker (bÃ¡sico) --------------------
        function registerServiceWorker(){ if('serviceWorker' in navigator){ navigator.serviceWorker.register('/sw.js').then(()=>{ console.log('SW registrado'); }).catch(()=>{}); } }

        // -------------------- Utilidades --------------------
        function escapeHtml(unsafe){ return unsafe.replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]; }); }

        // -------------------- Helper: registrar permisos cuando se crea la tarea para notificaciones programadas --------------------
        // (AquÃ­ se pueden agregar funciones para programar notificaciones basadas en time/date usando Service Workers + Push)

    </script>
</body>
</html>
                                
